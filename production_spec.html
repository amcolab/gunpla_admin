<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>UI Screen Specification – 製造実績アプリ（Production App）</title>
  <link rel="stylesheet" href="kintone-common-v2.css" />
  <style>
    body {
      margin: 0;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #f5f5f7;
      line-height: 1.7;
    }

    .spec-container {
      max-width: 980px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 8px;
      padding: 24px 32px;
      box-shadow: 0 0 0 1px rgba(0,0,0,0.04), 0 12px 30px rgba(0,0,0,0.06);
    }

    h1, h2, h3, h4 {
      margin-top: 1.4em;
      margin-bottom: 0.6em;
      color: #222;
    }

    h1 {
      font-size: 22px;
      border-bottom: 2px solid #e5e5ea;
      padding-bottom: 8px;
    }

    h2 {
      font-size: 18px;
    }

    h3 {
      font-size: 16px;
    }

    p {
      margin: 0.4em 0;
    }

    ul {
      margin: 0.4em 0 0.8em 1.4em;
    }

    ol {
      margin: 0.4em 0 0.8em 1.6em;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin: 0.5em 0 1.2em;
      font-size: 13px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      vertical-align: top;
    }

    th {
      background-color: #f2f2f7;
      font-weight: 600;
      white-space: nowrap;
    }

    .spec-meta {
      font-size: 12px;
      color: #666;
      margin-bottom: 12px;
    }

    .spec-tag {
      display: inline-block;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3949ab;
      margin-right: 6px;
    }

    .spec-callout {
      border-left: 4px solid #3f51b5;
      background: #f5f7ff;
      padding: 8px 12px;
      margin: 10px 0 16px;
      font-size: 13px;
    }

    .spec-screenshot {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px;
      background: #fafafa;
      text-align: center;
      margin: 8px 0 16px;
    }

    .spec-screenshot img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .spec-screenshot-caption {
      font-size: 12px;
      color: #666;
      margin-top: 6px;
    }

    @media print {
      body {
        background: #ffffff;
        padding: 0;
      }
      .spec-container {
        box-shadow: none;
        border-radius: 0;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="spec-container">

    <div class="spec-meta">
      <span class="spec-tag">UI Spec</span>
      <span class="spec-tag">Production App</span>
      Version 1.0 / 作成日: ________
    </div>

    <h1>UI Screen Specification – 製造実績アプリ（Production / Manufacturing Results App）</h1>
    <p><strong>対象画面:</strong> 製造実績一覧 / 製造実績詳細</p>
    <p><strong>想定利用者:</strong> 製造担当、現場リーダー、在庫管理担当（Credie 内部ユーザー）</p>

    <!-- 1. 画面の目的 -->
    <h2>1. 画面の目的（Purpose）</h2>
    <p>
      製造実績アプリは、製造現場で完成した製品ロットの情報を登録し、
      在庫・BOM と連携して次の処理を一元的に管理するための中核アプリです。
    </p>
    <ul>
      <li>① 完成品の入庫起点となるデータ登録（Physical Stock への IN のトリガー）</li>
      <li>② BOM に基づく原材料の自動引落（Logic Stock 減算）の起点</li>
      <li>③ 完成品ロットと原材料ロットの紐づけによるトレーサビリティ管理</li>
    </ul>
    <p>
      生産現場では「生産完了 → 製造実績登録 → 原材料引落 → 入庫タスク作成」という流れで運用し、
      在庫管理アプリ（Logic Stock / Physical Stock）および Task App と連携します。
    </p>

    <!-- 2. User Scenario -->
    <h2>2. User Scenario（利用者ストーリー）</h2>

    <h3>2.1 製造担当者のフロー</h3>
    <ol>
      <li>1日の生産が完了したタイミングで、製造担当者が Production App で<strong>「新規レコード作成」</strong>を実行する。</li>
      <li>完成した製品の SKU、Lot 番号、完成数量、不良数量などを入力し、レコードを保存する。</li>
      <li>保存後、システムが BOM を参照し、必要となる原材料の消費数量を自動計算して明細エリアに表示する。</li>
      <li>担当者は原材料と数量を確認し、問題なければ<strong>「原材料引落」</strong>ボタンを押して論理在庫の減算処理を実行する。</li>
      <li>原材料引落が正常に完了すると、在庫処理ステータスが更新され、必要に応じて<strong>「入庫タスク作成」</strong>ボタンを押す。</li>
      <li>入庫タスクは Task App に作成され、倉庫担当が実際の入庫処理（Physical Stock への反映）を行う。</li>
    </ol>

    <h3>2.2 在庫管理担当のフロー</h3>
    <ul>
      <li>Task App の入庫タスク一覧から、Production App で作成された入庫タスクを確認する。</li>
      <li>実際に倉庫へ入庫し、Task App 側で入庫数量を確定する。</li>
      <li>入庫タスク完了後、Physical Stock アプリの在庫数量が更新され、その結果は必要に応じて Production App やレポートから参照可能。</li>
    </ul>

    <!-- 3. 主な機能 / Business Impact -->
    <h2>3. 主な機能（Main Functions / Business Impacts）</h2>
    <ul>
      <li>✔ 製造ロット単位での完成数量・不良数量・完成日などの実績登録</li>
      <li>✔ BOM マスタ参照による原材料消費量の自動計算と表示</li>
      <li>✔ 原材料の Logic Stock 減算処理（原材料引落）</li>
      <li>✔ 完成品を倉庫に入庫するための入庫タスク自動生成（Task App 連携）</li>
      <li>✔ 完成品ロットと原材料ロットの紐づけによるトレーサビリティ管理</li>
      <li>✔ 在庫処理ステータスの可視化（未処理 / 原材料引落済 / 入庫タスク作成済 など）</li>
    </ul>

    <!-- 4. Scope / Out of Scope -->
    <h2>4. Scope / Out of Scope</h2>

    <h3>4.1 Scope</h3>
    <ul>
      <li>製造ロット単位の実績登録（SKU、Lot 番号、完成数量、不良数量、完成日、担当者など）</li>
      <li>BOM マスタとの連携による原材料リスト・使用数量の算出</li>
      <li>原材料引落（Logic Stock 減算）のトリガー処理</li>
      <li>入庫タスク作成（Task App へのレコード連携）</li>
      <li>在庫処理ステータスの管理と表示</li>
      <li>品質メモ・備考の管理</li>
    </ul>

    <h3>4.2 Out of Scope</h3>
    <ul>
      <li>製造指示書の発行・ラインスケジュール管理（別システム前提）</li>
      <li>詳細な品質検査項目の管理（別途 Quality App などで管理する想定がある場合）</li>
      <li>入庫作業そのもの（実作業および数量入力）は Task App 側の画面で実施</li>
      <li>原材料の購買・入庫（PO App / Stock App 側で管理）</li>
    </ul>

    <!-- 5. 画面レイアウト -->
    <h2>5. 画面レイアウト（Screen Layout）</h2>

    <!-- 5.1 一覧画面 -->
    <h3>5.1 製造実績一覧画面（List View）</h3>

    <div class="spec-callout">
      製造実績レコードを一覧で表示し、製品 SKU / Lot / 完成数量 / 不良率 / 完成日 / 在庫処理状況 を一目で確認できる画面です。
    </div>

    <table>
      <tr><th>項目名</th><th>説明</th></tr>
      <tr>
        <td>製造実績ID</td>
        <td>Kintone 自動採番の一意 ID。クリックで製造実績詳細画面へ遷移する。</td>
      </tr>
      <tr>
        <td>Lot 番号</td>
        <td>製造ロット番号。現場で管理しているロット体系に合わせて入力。</td>
      </tr>
      <tr>
        <td>製品 SKU</td>
        <td>完成した製品の SKU（Product Master 参照）。</td>
      </tr>
      <tr>
        <td>製品名</td>
        <td>SKU に紐づく製品名。</td>
      </tr>
      <tr>
        <td>完成数量</td>
        <td>製造された完成品の数量。</td>
      </tr>
      <tr>
        <td>不良数量</td>
        <td>廃棄・不良となった数量。</td>
      </tr>
      <tr>
        <td>不良率</td>
        <td>不良数量 ÷ 完成数量。表示のみ（計算ロジックは内部実装）。</td>
      </tr>
      <tr>
        <td>完成日</td>
        <td>製造完了日。</td>
      </tr>
      <tr>
        <td>在庫処理</td>
        <td>原材料引落・入庫タスク作成の状況（未処理 / 原材料引落済 / 入庫タスク作成済 など）。</td>
      </tr>
      <tr>
        <td>操作</td>
        <td>詳細ボタン。クリックで詳細画面へ。</td>
      </tr>
    </table>

    <h4>5.1.1 一覧画面の主な UI 要素</h4>
    <ul>
      <li><strong>「＋ 製造実績を記録」</strong>（新規作成ボタン）</li>
      <li>絞り込み条件（Lot 番号、SKU、完成日、在庫処理ステータス）</li>
      <li>標準の並び替え（完成日降順など）</li>
    </ul>

    <h4>5.1.2 スクリーンショット</h4>
    <div class="spec-screenshot">
      <img src="production_screen.png" alt="製造実績一覧画面" />
      <div class="spec-screenshot-caption">図1. 製造実績一覧画面（Production List）</div>
    </div>

    <!-- 5.2 詳細画面 -->
    <h3>5.2 製造実績詳細画面（Detail View）</h3>

    <div class="spec-callout">
      個別の製造ロットの詳細情報と、BOM 展開による原材料消費、在庫処理ステータスを確認・操作する画面です。
      入庫処理そのものは Task App 側で実施し、本画面はその起点と記録を管理します。
    </div>

    <h4>5.2.1 セクション構成</h4>
    <ul>
      <li>A. 製造ロット情報</li>
      <li>B. 在庫処理ステータス</li>
      <li>C. 原材料消費（BOM 展開）</li>
      <li>D. メモ・品質情報</li>
      <li>E. 操作ボタン</li>
    </ul>

    <!-- A. 製造ロット情報 -->
    <h4>A. 製造ロット情報</h4>
    <table>
      <tr><th>項目名</th><th>説明</th></tr>
      <tr>
        <td>製造実績ID</td>
        <td>自動採番レコード ID。</td>
      </tr>
      <tr>
        <td>完成日</td>
        <td>製造が完了した日付。</td>
      </tr>
      <tr>
        <td>製品 SKU</td>
        <td>完成品 SKU。Product Master から選択。</td>
      </tr>
      <tr>
        <td>製品名</td>
        <td>SKU に紐づく名称。読み取り専用。</td>
      </tr>
      <tr>
        <td>Lot 番号</td>
        <td>製造ロット番号。自由形式だが現場ルールに従う。</td>
      </tr>
      <tr>
        <td>完成数量</td>
        <td>完成した良品数量。入庫タスク作成時に使用される。</td>
      </tr>
      <tr>
        <td>不良数量</td>
        <td>不良・廃棄となった数量。</td>
      </tr>
      <tr>
        <td>不良率</td>
        <td>不良数量 ÷ （完成数量 + 不良数量）など、定義に合わせて計算。表示のみ。</td>
      </tr>
      <tr>
        <td>製造担当者</td>
        <td>このロットの生産を担当したユーザー名。</td>
      </tr>
    </table>

    <!-- B. 在庫処理ステータス -->
    <h4>B. 在庫処理ステータス</h4>
    <table>
      <tr><th>項目名</th><th>説明</th></tr>
      <tr>
        <td>原材料引落ステータス</td>
        <td>未処理 / 処理中 / 処理完了 / エラー など。原材料引落ボタン実行結果で自動更新。</td>
      </tr>
      <tr>
        <td>入庫タスクステータス</td>
        <td>未作成 / 作成済 / キャンセル など。Task App のタスク生成状況に応じて更新。</td>
      </tr>
      <tr>
        <td>在庫処理メッセージ</td>
        <td>エラー内容や警告（在庫不足など）を表示するフィールド。</td>
      </tr>
    </table>

    <!-- C. 原材料消費（BOM 展開） -->
    <h4>C. 原材料消費（BOM 展開）</h4>
    <p>
      完成品 SKU に紐づく BOM を展開し、完成数量に応じた原材料使用量を自動計算して表示します。
      原材料ロットの選択により、トレーサビリティ情報を保持します。
    </p>
    <table>
      <tr><th>項目</th><th>説明</th></tr>
      <tr>
        <td>資材コード / 名称</td>
        <td>BOM マスタから自動抽出される原材料の SKU / 名称。</td>
      </tr>
      <tr>
        <td>基準使用量</td>
        <td>1 個あたりの使用量（BOM に登録されている値）。</td>
      </tr>
      <tr>
        <td>使用数量</td>
        <td>完成数量 × 基準使用量。原則自動計算・表示のみ。</td>
      </tr>
      <tr>
        <td>資材ロット</td>
        <td>実際に使用した原材料ロットを選択。必須入力（トレーサビリティのため）。</td>
      </tr>
      <tr>
        <td>ロット在庫残数</td>
        <td>選択された原材料ロットの現在在庫。参考表示。</td>
      </tr>
    </table>

    <!-- D. メモ・品質情報 -->
    <h4>D. メモ・品質情報</h4>
    <table>
      <tr><th>項目名</th><th>説明</th></tr>
      <tr>
        <td>品質メモ / 備考</td>
        <td>ライン停止、設備トラブル、不良発生要因など品質管理に関する自由記述欄。</td>
      </tr>
      <tr>
        <td>添付ファイル</td>
        <td>検査結果シート、写真、報告書などを添付可能なファイルフィールド（必要に応じて）。</td>
      </tr>
    </table>

    <!-- E. 操作ボタン -->
    <h4>E. 操作ボタン</h4>
    <ul>
      <li>
        <strong>原材料引落</strong>：
        BOM 展開された原材料について Logic Stock を減算する処理を実行。<br />
        成功時は原材料引落ステータスを「処理完了」に更新し、在庫不足などエラーの場合はメッセージを表示。
      </li>
      <li>
        <strong>入庫タスク作成</strong>：
        完成数量・製品 SKU・Lot 番号をもとに Task App に入庫タスクを1件生成する。再生成は原則不可（管理者のみ例外対応）。
      </li>
      <li>
        <strong>編集</strong>：
        完成数量・不良数量・品質メモなどを修正する標準編集ボタン。
      </li>
      <li>
        <strong>削除</strong>：
        誤登録レコードを削除（権限は管理者のみ想定）。在庫処理済みレコードの削除は制限する方針を検討。
      </li>
    </ul>

    <h4>5.2.2 スクリーンショット</h4>
    <div class="spec-screenshot">
      <img src="production_detail_screen.png" alt="製造実績詳細画面" />
      <div class="spec-screenshot-caption">図2. 製造実績詳細画面（Production Detail）</div>
    </div>

    <!-- 6. 確認事項 -->
    <h2>6. お客様に確認いただきたい点</h2>
    <ul>
      <li>製造実績として必要な項目（Lot 番号、完成数量、不良数量、品質メモなど）は十分でしょうか？追加で管理したい項目はありますか？</li>
      <li>BOM 展開の考え方（完成数量 × 基準使用量）や端数処理のルールに、現場ルールとの乖離はありませんか？</li>
      <li>原材料ロットを必須入力とする運用で問題ないでしょうか？（トレーサビリティ要件）</li>
      <li>原材料引落、入庫タスク作成のタイミングと権限（誰がいつ実行するか）について、運用イメージに差異はありませんか？</li>
    </ul>

    <!-- 7. 開発向けメモ -->
    <h2>7. 開発向けメモ（Dev Notes）</h2>
    <ul>
      <li>BOM マスタ（BOM App）との参照が前提。完成品 SKU から BOM を一意に取得できないケースがある場合はエラーとする。</li>
      <li>原材料ロットは Inventory / Physical Stock 側のロット情報と整合性を保つ必要がある。</li>
      <li>原材料引落と入庫タスク作成は、二重実行を防ぐためフラグ管理を行う（再実行時は警告表示）。</li>
      <li>在庫不足の場合は原材料引落処理をロールバックし、ユーザーへメッセージ表示。</li>
      <li>将来的に生産計画との連携を行う場合に備え、製造指示IDなどの拡張フィールドを追加できるようにしておく。</li>
    </ul>

  </div>
</body>
</html>
