<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>UI Screen Specification - 入出庫履歴アプリ（Stock Movement History）</title>
  <link rel="stylesheet" href="kintone-common-v2.css" />
  <style>
    body {
      margin: 0;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #f5f5f7;
    }

    .spec-container {
      max-width: 980px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 8px;
      padding: 24px 32px;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.04), 0 12px 30px rgba(0, 0, 0, 0.06);
    }

    .spec-meta {
      font-size: 12px;
      color: #666;
      margin-bottom: 12px;
    }

    .spec-tag {
      display: inline-block;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3949ab;
      margin-right: 6px;
    }

    h1,
    h2,
    h3,
    h4 {
      margin-top: 1.4em;
      margin-bottom: 0.6em;
    }

    h1 {
      font-size: 22px;
      border-bottom: 2px solid #e5e5ea;
      padding-bottom: 8px;
    }

    h2 {
      font-size: 18px;
    }

    h3 {
      font-size: 16px;
    }

    h4 {
      font-size: 14px;
    }

    p {
      line-height: 1.6;
      margin: 0.4em 0;
      font-size: 13px;
    }

    ul,
    ol {
      font-size: 13px;
      margin: 0.4em 0 0.8em 1.5em;
      padding-left: 0;
    }

    li {
      margin-bottom: 4px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin: 0.5em 0 1.2em;
      font-size: 13px;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      vertical-align: top;
      text-align: left;
    }

    th {
      background-color: #f2f2f7;
      font-weight: 600;
      white-space: nowrap;
    }

    .list-table th:first-child,
    .list-table td:first-child {
      width: 10%;
    }

    .image-container {
      text-align: center;
      margin-top: 15px;
    }

    .image-container img {
      max-width: 100%;
      border-radius: 6px;
      border: 1px solid #ddd;
    }

    .spec-screenshot-caption {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    @media print {
      body {
        background: #ffffff;
        padding: 0;
      }

      .spec-container {
        box-shadow: none;
        border-radius: 0;
        max-width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="spec-container">
    <div class="spec-meta">
      <span class="spec-tag">UI Spec</span>
      <span class="spec-tag">Stock Movement</span>
      Version 1.1 / 作成日: ________
    </div>

    <h1>入出庫履歴アプリ（Stock Movement History App）UI画面仕様書</h1>
    <p><strong>対象画面:</strong> 在庫移動履歴 一覧</p>
    <p><strong>別名:</strong> 監査ログ (Audit Log) App</p>

    <h2>画面の目的（ビジネス上の役割）</h2>
    <p>
      本アプリは、実在庫（Physical Stock）の増減およびロケーション変更に関する全てのトランザクションを時系列で記録する監査ログ（Audit Trail）です。
      ここでいう「全て」には、倉庫オペレーション起点の入出庫だけでなく、販売出荷・販売返品など販売トランザクションに紐づく実在庫移動も含まれます。
    </p>
    <ul>
      <li>在庫追跡（トレーサビリティ）: 特定の商品・ロットが、いつ、どこから、どこへ、なぜ移動したかを完全に追跡できるようにします。</li>
      <li>差異分析の基盤: 在庫の差異（棚卸差異）が発生した際、どのトランザクションが原因かを特定するための基礎データを提供します。</li>
      <li>監査証跡: 全ての在庫増減がタスク（Task App）または受注/販売トランザクションを通じて発生していることを証明する記録です。</li>
      <li>販売履歴との突合: BtoB受注やEC販売（Shopify等）に紐づく出荷・返品の実在庫履歴も一元管理し、販売データとの照合を容易にします。</li>
    </ul>

    <h2>利用者ストーリー（User Scenario）</h2>
    <ol>
      <li>経理/監査担当者:
        特定の期間における特定ロットの入庫トランザクションや、棚卸調整のトランザクションのみをフィルタし、在庫計上の正当性を確認したい。
      </li>
      <li>運用担当者:
        ある Lot の在庫が突然減っていることに気づいた場合、このアプリでそのLotを検索し、最終的な移動元（移動元/倉庫）とタスクIDを追跡して、原因を究明する。
      </li>
      <li>CS／セールス担当者:
        特定の注文（受注ID/注文番号）について、いつどの倉庫から何個出荷されたか、返品があったかどうかを在庫側の履歴から確認したい。
      </li>
      <li>システム（Task App / 受注アプリから）:
        Task Appでタスクが「完了」になった際、または販売出荷/返品処理が確定した際に、Ruby Serverがこのアプリに新しい移動履歴レコードを自動生成します。
      </li>
    </ol>

    <h2>主要機能</h2>
    <ul>
      <li>在庫移動トランザクションの一覧表示、検索、フィルタリング。</li>
      <li><code>移動種別</code>、<code>ロット</code>、<code>タスクID</code>、<code>受注ID/販売ID</code>に基づく迅速なデータ検索。</li>
      <li><code>タスクID</code>を通じた Task App（作業指示）へのドリルダウンリンクの提供。</li>
      <li>販売トランザクション（注文アプリ/Shopify等）との紐づけ情報を保持し、販売履歴との突合を可能にする。</li>
      <li>在庫監査・障害分析用のCSVエクスポート機能。</li>
    </ul>

    <h2>画面レイアウト</h2>

    <h3>4.1 表示項目（List）</h3>
    <p>
      本一覧は、実在庫の増減が発生するたびに 1 レコードとして、その履歴を記録します。
      ここには、購買入庫・倉庫内移動・棚卸調整だけでなく、販売出荷・販売返品に伴う在庫移動も同じ形式で記録されます。
    </p>
    <table class="list-table">
      <thead>
        <tr>
          <th>項目名</th>
          <th>説明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>移動ID</strong></td>
          <td>在庫移動トランザクションを一意に識別するID。</td>
        </tr>
        <tr>
          <td><strong>移動種別</strong></td>
          <td>
            移動の目的。主な値の例：<br />
            ・入荷（購買入庫）<br />
            ・出荷（販売出庫/BtoB出荷/EC出荷）<br />
            ・棚移動（ロケーション変更）<br />
            ・棚卸調整（プラス/マイナス）<br />
            ・返品入庫（販売返品／BtoB返品）<br />
            ・その他サンプル出庫 等
          </td>
        </tr>
        <tr>
          <td><strong>移動日時</strong></td>
          <td>移動トランザクションが発生した正確な日時。（Task Appの完了日時、または販売出荷確定日時と一致）</td>
        </tr>
        <tr>
          <td><strong>商品名</strong></td>
          <td>移動対象となった製品/資材の名称。</td>
        </tr>
        <tr>
          <td><strong>SKU</strong></td>
          <td>商品を識別するコード（必要に応じて表示）。</td>
        </tr>
        <tr>
          <td><strong>ロット</strong></td>
          <td>移動対象の在庫ロット番号。</td>
        </tr>
        <tr>
          <td><strong>数量</strong></td>
          <td>移動した数量。入庫時はプラス（+）、出庫時はマイナス（−）で表示。</td>
        </tr>
        <tr>
          <td><strong>移動元/倉庫</strong></td>
          <td>移動前のロケーション、または入庫時のソース倉庫名。（例: Gifu / Manufacture）</td>
        </tr>
        <tr>
          <td><strong>移動先/ロケーション</strong></td>
          <td>移動後の棚番/ロケーション、または出庫時のディスティネーション。（例: A-01-02 / お客様）</td>
        </tr>
        <tr>
          <td><strong>タスクID</strong></td>
          <td>当該移動をトリガーしたTask AppのレコードID。クリックでTask App詳細へ遷移。</td>
        </tr>
        <tr>
          <td><strong>受注ID/販売ID</strong></td>
          <td>
            販売に紐づく移動の場合、その元となるトランザクションID（受注アプリの受注ID、Shopify注文番号など）。<br />
            在庫側から販売履歴を辿るためのキーとして利用。
          </td>
        </tr>
        <tr>
          <td><strong>チャネル区分</strong></td>
          <td>販売経路の区分（例: BtoBポータル / EC / 卸 等）。販売関連トランザクションの分析用。</td>
        </tr>
        <tr>
          <td><strong>担当者</strong></td>
          <td>当該作業を実行した担当者（Task Appや販売処理から連携）。</td>
        </tr>
      </tbody>
    </table>

    <h4>UI要素・操作</h4>
    <ul>
      <li>画面タイトル: 在庫移動履歴 App (仮称)</li>
      <li>検索: 移動種別、日付、ロット、タスクID、受注ID/販売ID、チャネル区分によるフィルタリング。</li>
      <li>操作: エクスポート (Export CSV) - 監査レポート作成・販売/在庫突合に必須。</li>
    </ul>

    <h3>4.2 スクリーンショット</h3>
    <div class="image-container">
      <img src="stock_movement_history_screen.png" alt="入出庫履歴アプリ 一覧画面" />
      <p class="spec-screenshot-caption">図1. 入出庫履歴アプリ 一覧画面</p>
    </div>

    <h2>お客様に確認いただきたい点</h2>
    <p>移動履歴の管理ロジックに関する重要な確認点です。</p>
    <ol>
      <li>
        レコード生成のソース:<br />
        このアプリのレコードは、基本的に Task App が「完了」になった時、または販売出荷/返品処理が確定した時に Ruby Server から自動生成される仕様としてよろしいでしょうか？<br />
        （手動でのレコード追加は禁止とする想定）
      </li>
      <li>
        数量表示:<br />
        数量は、入庫時はプラス（+）、出庫時はマイナス（−）で記録する仕様でよろしいでしょうか？
      </li>
      <li>
        棚卸調整の種別:<br />
        移動種別に「棚卸調整（プラス）」と「棚卸調整（マイナス）」のように、調整の方向を分けて記録する必要がありますか？
      </li>
      <li>
        販売連携項目:<br />
        受注ID/販売ID、チャネル区分など、販売側との突合に最低限必要な項目が他にあればご指示ください。
      </li>
    </ol>

    <h2>開発向けメモ（Dev Notes）</h2>
    <ul>
      <li>
        生成トリガー:<br />
        ・Task App からの Webhook/API コールにより、タスク完了時に自動生成。<br />
        ・販売出荷/返品（受注アプリ、Shopify等）確定時にも、Ruby Server が同じテーブルにレコードを生成する。<br />
        → 本アプリは「実在庫実績の唯一のテーブル」として、倉庫起点と販売起点の両方を一元管理する。
      </li>
      <li>
        データ連携:<br />
        Task App のレコード（タスク種別、数量、担当者、タスクID）および Physical Stock App（ロット、入庫日）、
        さらに受注アプリ/Shopify 等の販売トランザクション（受注ID、チャネル区分）から必要なデータを集約し、レコードを作成する。
      </li>
      <li>
        ユニークキー:<br />
        移動ID は、プレフィックス + 日付 + 連番で自動採番し、ユニーク性を確保する。
      </li>
      <li>
        監査:<br />
        数量フィールドや販売紐づけID（受注ID/販売ID）は原則編集不可とする（監査証跡のため）。修正が必要な場合は、調整用の新規トランザクションとして記録する設計を推奨。
      </li>
    </ul>

  </div>
  <script src="auth.js"></script>
</body>

</html>