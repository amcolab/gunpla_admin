<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨å“è¡¨ç®¡ç† (BOM) - Kintone</title>

    <!-- Kintone Common Stylesheet -->
    <link rel="stylesheet" href="kintone-common-v2.css">

    <style>
        /* BOM-specific styles */
        .expand-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 12px;
            margin-right: 8px;
            padding: 0;
            transition: transform 0.2s;
        }

        .expand-btn.expanded {
            transform: rotate(90deg);
        }

        .sub-row {
            background-color: #f9f9f9;
            padding-left: 40px !important;
            font-size: 12px;
        }

        .sub-components {
            display: none;
        }

        .sub-components.show {
            display: table-row;
        }

        .total-cost {
            font-weight: 600;
            color: #e67e22;
        }

        .cost-value {
            color: #666;
        }

        .quantity-value {
            font-weight: 500;
        }

        .component-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            background-color: #e8f4f8;
            color: #1769aa;
        }
    </style>
</head>

<body>
    <!-- Kintone Header -->
    <div class="kintone-header">
        <div class="app-icon-circle">ğŸ“‹</div>
        <div class="app-title-header">éƒ¨å“è¡¨ç®¡ç† (BOM)</div>
    </div>

    <!-- Secondary Navigation -->
    <div class="secondary-nav">
        <div class="nav-icon">ğŸ </div>
        <span class="breadcrumb-text">ã‚¢ãƒ—ãƒª: éƒ¨å“è¡¨ç®¡ç†</span>
        <div class="nav-right">
            <div class="nav-icon">âš™ï¸</div>
            <div class="nav-icon">â“</div>
        </div>
    </div>

    <!-- App Description -->
    <div class="app-description">
        éƒ¨å“è¡¨ï¼ˆBOM - Bill of Materialsï¼‰ç®¡ç†ã‚¢ãƒ—ãƒªã¯ã€è£½å“ã®æ§‹æˆéƒ¨å“ã€åŸæ–™ã€è³‡æã®æƒ…å ±ã‚’ç®¡ç†ã—ã¾ã™ã€‚
        å„è£½å“ã®åŸä¾¡è¨ˆç®—ã«ã‚‚ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
    </div>

    <!-- View Controls -->
    <div class="view-controls">
        <button class="view-button">
            <span class="view-icon">ğŸ“‹</span>
            <span class="view-text">å…¨BOMä¸€è¦§</span>
            <span class="dropdown-arrow">â–¼</span>
        </button>

        <button class="control-btn">
            <span class="control-btn-icon">ğŸ”</span>
        </button>

        <button class="control-btn">
            <span class="control-btn-icon">ğŸ“Š</span>
        </button>

        <div class="controls-right">
            <button class="icon-only-btn" onclick="addBOM()">â•</button>
            <button class="icon-only-btn">âš™ï¸</button>
            <button class="icon-only-btn">â‹¯</button>
        </div>
    </div>

    <!-- Record Count Top -->
    <div class="record-count" id="topCount">1 - 8ï¼ˆ8ä»¶ä¸­ï¼‰</div>

    <!-- Data Table -->
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>BOM ID</th>
                    <th>è£½å“å</th>
                    <th>æ§‹æˆå“</th>
                    <th>åŒºåˆ†</th>
                    <th>æ•°é‡</th>
                    <th>å˜ä½</th>
                    <th>å˜ä¾¡</th>
                    <th>é‡‘é¡</th>
                    <th>åˆè¨ˆåŸä¾¡</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="bomTableBody">
                <!-- Data will be rendered here -->
            </tbody>
        </table>
    </div>

    <!-- Record Count Bottom -->
    <div class="bottom-count" id="bottomCount">1 - 8ï¼ˆ8ä»¶ä¸­ï¼‰</div>
    <script src="auth.js"></script>
    <script>
        // BOM data structure
        const bomData = [
            {
                id: '00001',
                product: 'Rice Silica 500mL',
                totalCost: 95.02,
                components: [
                    { name: 'ç”°ä¸ƒäººå‚', type: 'åŸæ–™', quantity: 50, unit: 'g', unitCost: 0.80, amount: 40.00 },
                    { name: 'ãƒœãƒˆãƒ« PEPI-500', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 45.00, amount: 45.00 },
                    { name: 'ãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 4.02, amount: 4.02 },
                    { name: 'ã‚­ãƒ£ãƒƒãƒ— P-27', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 6.00, amount: 6.00 }
                ]
            },
            {
                id: '00002',
                product: 'Si+ 250mL',
                totalCost: 78.50,
                components: [
                    { name: 'ãƒ©ã‚¤ã‚¹ã‚·ãƒªã‚«åŸæ–™', type: 'åŸæ–™', quantity: 200, unit: 'g', unitCost: 0.20, amount: 40.00 },
                    { name: 'ãƒœãƒˆãƒ« PEPI-250', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 28.00, amount: 28.00 },
                    { name: 'ãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 3.50, amount: 3.50 },
                    { name: 'ã‚­ãƒ£ãƒƒãƒ—', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 7.00, amount: 7.00 }
                ]
            },
            {
                id: '00003',
                product: 'Rice Silica PREMIUM 500mL',
                totalCost: 120.00,
                components: [
                    { name: 'é«˜æ¿ƒåº¦ãƒ©ã‚¤ã‚¹ã‚·ãƒªã‚«', type: 'åŸæ–™', quantity: 400, unit: 'g', unitCost: 0.15, amount: 60.00 },
                    { name: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒœãƒˆãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 50.00, amount: 50.00 },
                    { name: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 6.00, amount: 6.00 },
                    { name: 'ã‚­ãƒ£ãƒƒãƒ—', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 4.00, amount: 4.00 }
                ]
            },
            {
                id: '00004',
                product: 'Rice Silica 200mL',
                totalCost: 65.30,
                components: [
                    { name: 'ãƒ©ã‚¤ã‚¹ã‚·ãƒªã‚«åŸæ–™', type: 'åŸæ–™', quantity: 150, unit: 'g', unitCost: 0.20, amount: 30.00 },
                    { name: 'ãƒœãƒˆãƒ« 200mL', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 25.00, amount: 25.00 },
                    { name: 'ãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 3.30, amount: 3.30 },
                    { name: 'ã‚­ãƒ£ãƒƒãƒ—', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 7.00, amount: 7.00 }
                ]
            },
            {
                id: '00005',
                product: 'Rice Silica 75mL',
                totalCost: 42.15,
                components: [
                    { name: 'ãƒ©ã‚¤ã‚¹ã‚·ãƒªã‚«åŸæ–™', type: 'åŸæ–™', quantity: 60, unit: 'g', unitCost: 0.20, amount: 12.00 },
                    { name: 'ãƒœãƒˆãƒ« 75mL', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 20.00, amount: 20.00 },
                    { name: 'ãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 2.15, amount: 2.15 },
                    { name: 'ã‚­ãƒ£ãƒƒãƒ—', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 8.00, amount: 8.00 }
                ]
            },
            {
                id: '00006',
                product: 'Rice Silica 50mL',
                totalCost: 38.20,
                components: [
                    { name: 'ãƒ©ã‚¤ã‚¹ã‚·ãƒªã‚«åŸæ–™', type: 'åŸæ–™', quantity: 40, unit: 'g', unitCost: 0.20, amount: 8.00 },
                    { name: 'ãƒœãƒˆãƒ« 50mL', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 18.00, amount: 18.00 },
                    { name: 'ãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 2.20, amount: 2.20 },
                    { name: 'ã‚­ãƒ£ãƒƒãƒ—', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 10.00, amount: 10.00 }
                ]
            },
            {
                id: '00007',
                product: 'SASA-LABO 50mL',
                totalCost: 85.50,
                components: [
                    { name: 'ã‚µã‚µãƒ˜ãƒ«ã‚¹åŸæ–™', type: 'åŸæ–™', quantity: 45, unit: 'g', unitCost: 1.00, amount: 45.00 },
                    { name: 'ãƒœãƒˆãƒ« NCC-180', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 22.00, amount: 22.00 },
                    { name: 'ãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 8.50, amount: 8.50 },
                    { name: 'ã‚­ãƒ£ãƒƒãƒ— CSã‚­ãƒ£ãƒƒãƒ—', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 10.00, amount: 10.00 }
                ]
            },
            {
                id: '00008',
                product: 'Dr\'s Power (OEM)',
                totalCost: 150.00,
                components: [
                    { name: 'OEMåŸæ–™ãƒŸãƒƒã‚¯ã‚¹', type: 'åŸæ–™', quantity: 300, unit: 'g', unitCost: 0.30, amount: 90.00 },
                    { name: 'OEMãƒœãƒˆãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æœ¬', unitCost: 40.00, amount: 40.00 },
                    { name: 'OEMãƒ©ãƒ™ãƒ«', type: 'è³‡æ', quantity: 1, unit: 'æš', unitCost: 12.00, amount: 12.00 },
                    { name: 'OEMã‚­ãƒ£ãƒƒãƒ—', type: 'è³‡æ', quantity: 1, unit: 'å€‹', unitCost: 8.00, amount: 8.00 }
                ]
            }
        ];

        // Track expanded rows
        const expandedRows = new Set();

        // Render table
        function renderTable() {
            const tbody = document.getElementById('bomTableBody');
            let html = '';

            bomData.forEach(bom => {
                const isExpanded = expandedRows.has(bom.id);

                // Main BOM row
                html += `
                    <tr>
                        <td>
                            <button class="expand-btn ${isExpanded ? 'expanded' : ''}" 
                                    onclick="toggleExpand('${bom.id}')">â–¶</button>
                            <a href="#" class="record-link" onclick="viewBOM('${bom.id}'); return false;">
                                ${bom.id}
                            </a>
                        </td>
                        <td>
                            <a href="#" class="record-link" onclick="viewProduct('${bom.product}'); return false;">
                                ${bom.product}
                            </a>
                        </td>
                        <td>â€”</td>
                        <td>â€”</td>
                        <td>â€”</td>
                        <td>â€”</td>
                        <td>â€”</td>
                        <td>â€”</td>
                        <td>
                            <span class="total-cost">Â¥${bom.totalCost.toFixed(2)}</span>
                        </td>
                        <td>
                            <div class="row-actions">
                                <button class="action-icon edit" 
                                        title="ç·¨é›†" 
                                        onclick="editBOM('${bom.id}')">
                                </button>
                                <button class="action-icon delete" 
                                        title="å‰Šé™¤" 
                                        onclick="deleteBOM('${bom.id}')">
                                </button>
                            </div>
                        </td>
                    </tr>
                `;

                // Component rows
                bom.components.forEach(comp => {
                    html += `
                        <tr class="sub-components ${isExpanded ? 'show' : ''}" data-parent="${bom.id}">
                            <td class="sub-row"></td>
                            <td class="sub-row"></td>
                            <td class="sub-row">
                                <a href="#" class="record-link" onclick="viewComponent('${comp.name}'); return false;">
                                    ${comp.name}
                                </a>
                            </td>
                            <td class="sub-row">
                                <span class="component-type">${comp.type}</span>
                            </td>
                            <td class="sub-row">
                                <span class="quantity-value">${comp.quantity}</span>
                            </td>
                            <td class="sub-row">
                                <span>${comp.unit}</span>
                            </td>
                            <td class="sub-row">
                                <span class="cost-value">Â¥${comp.unitCost.toFixed(2)}</span>
                            </td>
                            <td class="sub-row">
                                <span class="cost-value">Â¥${comp.amount.toFixed(2)}</span>
                            </td>
                            <td class="sub-row"></td>
                            <td class="sub-row"></td>
                        </tr>
                    `;
                });
            });

            tbody.innerHTML = html;
            updateRecordCount();
        }

        // Toggle expand/collapse
        function toggleExpand(bomId) {
            if (expandedRows.has(bomId)) {
                expandedRows.delete(bomId);
            } else {
                expandedRows.add(bomId);
            }
            renderTable();
        }

        // Update record count
        function updateRecordCount() {
            const count = bomData.length;
            const countText = `1 - ${count}ï¼ˆ${count}ä»¶ä¸­ï¼‰`;
            document.getElementById('topCount').textContent = countText;
            document.getElementById('bottomCount').textContent = countText;
        }

        // View BOM details
        function viewBOM(id) {
            const bom = bomData.find(b => b.id === id);
            if (bom) {
                alert(`BOMè©³ç´°:\n\n` +
                    `BOM ID: ${bom.id}\n` +
                    `è£½å“å: ${bom.product}\n` +
                    `æ§‹æˆå“æ•°: ${bom.components.length}ç‚¹\n` +
                    `åˆè¨ˆåŸä¾¡: Â¥${bom.totalCost.toFixed(2)}\n\n` +
                    `â€» BOMè©³ç´°ç”»é¢ã‚’é–‹ãã¾ã™`);
            }
        }

        // View product
        function viewProduct(productName) {
            alert(`è£½å“è©³ç´°:\n\n` +
                `è£½å“å: ${productName}\n\n` +
                `â€» è£½å“ãƒã‚¹ã‚¿è©³ç´°ç”»é¢ã‚’é–‹ãã¾ã™`);
        }

        // View component
        function viewComponent(componentName) {
            alert(`æ§‹æˆå“è©³ç´°:\n\n` +
                `æ§‹æˆå“å: ${componentName}\n\n` +
                `â€» è³‡æãƒã‚¹ã‚¿è©³ç´°ç”»é¢ã‚’é–‹ãã¾ã™`);
        }

        // Edit BOM
        function editBOM(id) {
            const bom = bomData.find(b => b.id === id);
            if (bom) {
                alert(`BOMã‚’ç·¨é›†:\n\n` +
                    `BOM ID: ${bom.id}\n` +
                    `è£½å“å: ${bom.product}\n\n` +
                    `â€» ç·¨é›†ç”»é¢ã‚’é–‹ãã¾ã™`);
            }
        }

        // Delete BOM
        function deleteBOM(id) {
            const bom = bomData.find(b => b.id === id);
            if (bom) {
                if (confirm(`ã“ã®BOMã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n\n` +
                    `BOM ID: ${bom.id}\n` +
                    `è£½å“å: ${bom.product}`)) {
                    const index = bomData.findIndex(b => b.id === id);
                    if (index > -1) {
                        bomData.splice(index, 1);
                        expandedRows.delete(id);
                        renderTable();
                        alert('BOMã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
                    }
                }
            }
        }

        // Add new BOM
        function addBOM() {
            alert('æ–°è¦BOMè¿½åŠ ç”»é¢ã‚’é–‹ãã¾ã™ã€‚\n\n' +
                'â€» å®Ÿè£…æ™‚ã¯BOMç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
        }

        // Initial render
        renderTable();

        // Log info
        console.log('éƒ¨å“è¡¨ç®¡ç†ã‚¢ãƒ—ãƒª - ãƒ­ãƒ¼ãƒ‰å®Œäº†');
        console.log(`BOMæ•°: ${bomData.length}ä»¶`);
    </script>
</body>

</html>